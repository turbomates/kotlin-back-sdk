package dev.tmsoft.lib.upload

import javax.activation.UnsupportedDataTypeException
import kotlinx.coroutines.runBlocking
import kotlinx.serialization.Serializable
import kotlinx.serialization.json.Json
import org.junit.jupiter.api.Assertions
import org.junit.jupiter.api.Test

class FileTest {
    @Test
    fun `file serialization`() {
        val command = Json.decodeFromString(Command.serializer(), "{\"file\":\"data:application/pdf;base64,JVBERi0xLjMN\"}")
        Assertions.assertEquals(command.file.extension, "pdf")
        Assertions.assertTrue(command.file is Application)
    }

    @Test
    fun `save with local fileManager`() {
        val fileManager = LocalFileManager("http://localhost:3000")
        val file = Application("data:application/pdf;base64,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OTAwNzQwMDY1MDA3Mj4KL1Byb2R1Y2VyPEZFRkYwMDRDMDA2OTAwNjIwMDcyMDA2NTAwNEYwMDY2MDA2NjAwNjkwMDYzMDA2NTAwMjAwMDM3MDAyRTAwMzI+Ci9DcmVhdGlvbkRhdGUoRDoyMDIyMDUyNzExNTcyNSswMicwMCcpPj4KZW5kb2JqCgp4cmVmCjAgMTQKMDAwMDAwMDAwMCA2NTUzNSBmIAowMDAwMDA1OTI2IDAwMDAwIG4gCjAwMDAwMDAwMTkgMDAwMDAgbiAKMDAwMDAwMDE4MyAwMDAwMCBuIAowMDAwMDA2MDY5IDAwMDAwIG4gCjAwMDAwMDAyMDIgMDAwMDAgbiAKMDAwMDAwNTE1NSAwMDAwMCBuIAowMDAwMDA1MTc2IDAwMDAwIG4gCjAwMDAwMDUzNjQgMDAwMDAgbiAKMDAwMDAwNTY2OSAwMDAwMCBuIAowMDAwMDA1ODM5IDAwMDAwIG4gCjAwMDAwMDU4NzEgMDAwMDAgbiAKMDAwMDAwNjE2OCAwMDAwMCBuIAowMDAwMDA2MjY1IDAwMDAwIG4gCnRyYWlsZXIKPDwvU2l6ZSAxNC9Sb290IDEyIDAgUgovSW5mbyAxMyAwIFIKL0lEIFsgPDI5MjNGQTlBRkQ5RDczNUUxMkYyRTRGOTk0MTcyRjZDPgo8MjkyM0ZBOUFGRDlENzM1RTEyRjJFNEY5OTQxNzJGNkM+IF0KL0RvY0NoZWNrc3VtIC9DRjQ4NzBCQ0QyNEI0QzAzMTg3QUI1ODY3QzU2QjVERQo+PgpzdGFydHhyZWYKNjQ0MAolJUVPRgo=")
        val command = Json.decodeFromString(Command.serializer(), "{\"file\":\"data:application/pdf;base64,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OTAwNzQwMDY1MDA3Mj4KL1Byb2R1Y2VyPEZFRkYwMDRDMDA2OTAwNjIwMDcyMDA2NTAwNEYwMDY2MDA2NjAwNjkwMDYzMDA2NTAwMjAwMDM3MDAyRTAwMzI+Ci9DcmVhdGlvbkRhdGUoRDoyMDIyMDUyNzExNTcyNSswMicwMCcpPj4KZW5kb2JqCgp4cmVmCjAgMTQKMDAwMDAwMDAwMCA2NTUzNSBmIAowMDAwMDA1OTI2IDAwMDAwIG4gCjAwMDAwMDAwMTkgMDAwMDAgbiAKMDAwMDAwMDE4MyAwMDAwMCBuIAowMDAwMDA2MDY5IDAwMDAwIG4gCjAwMDAwMDAyMDIgMDAwMDAgbiAKMDAwMDAwNTE1NSAwMDAwMCBuIAowMDAwMDA1MTc2IDAwMDAwIG4gCjAwMDAwMDUzNjQgMDAwMDAgbiAKMDAwMDAwNTY2OSAwMDAwMCBuIAowMDAwMDA1ODM5IDAwMDAwIG4gCjAwMDAwMDU4NzEgMDAwMDAgbiAKMDAwMDAwNjE2OCAwMDAwMCBuIAowMDAwMDA2MjY1IDAwMDAwIG4gCnRyYWlsZXIKPDwvU2l6ZSAxNC9Sb290IDEyIDAgUgovSW5mbyAxMyAwIFIKL0lEIFsgPDI5MjNGQTlBRkQ5RDczNUUxMkYyRTRGOTk0MTcyRjZDPgo8MjkyM0ZBOUFGRDlENzM1RTEyRjJFNEY5OTQxNzJGNkM+IF0KL0RvY0NoZWNrc3VtIC9DRjQ4NzBCQ0QyNEI0QzAzMTg3QUI1ODY3QzU2QjVERQo+PgpzdGFydHhyZWYKNjQ0MAolJUVPRgo=\"}")
        runBlocking {
            val path = fileManager.add(file, "documents", "file")
            val uri = fileManager.getWebUri(path)
            Assertions.assertEquals("http://localhost:3000/uploads/documents/file.pdf", uri)
            Assertions.assertEquals(file.extension, "pdf")

            val path2 = fileManager.add(command.file, "documents", "command")
            val uri2 = fileManager.getWebUri(path2)
            Assertions.assertEquals("http://localhost:3000/uploads/documents/command.pdf", uri2)
            Assertions.assertEquals(command.file.extension, "pdf")
        }
    }

    @Test
    fun `type comparison`() {
        Assertions.assertThrows(UnsupportedDataTypeException::class.java) {
            Json.decodeFromString(Command.serializer(), "{\"file\":\"data:audio/mp3;base64,JVBERi0xLjMN\"}")
        }
        Assertions.assertThrows(UnsupportedDataTypeException::class.java) {
            Json.decodeFromString(Command.serializer(), "{\"file\":\"JVBERi0xLjMN\"}")
        }
        val application = Json.decodeFromString(Command.serializer(), "{\"file\":\"data:application/pdf;base64,JVBERi0xLjMN\"}").file
        val text = Json.decodeFromString(Command.serializer(), "{\"file\":\"data:text/csv;base64,JVBERi0xLjMN\"}").file
        val image = Json.decodeFromString(Command.serializer(), "{\"file\":\"data:image/png;base64,JVBERi0xLjMN\"}").file
        val application2 = Application("JVBERi0xLjMN")
        val text2 = Text("JVBERi0xLjMN")
        val image2 = Image("JVBERi0xLjMN")
        Assertions.assertTrue(application is Application)
        Assertions.assertTrue(text is Text)
        Assertions.assertTrue(image is Image)
        Assertions.assertTrue(application2.extension == "json")
        Assertions.assertTrue(text2.extension == "txt")
        Assertions.assertTrue(image2.extension == "svg")
    }

    @Serializable
    data class Command(
        @Serializable(FileSerializer::class)
        val file: File
    )
}
